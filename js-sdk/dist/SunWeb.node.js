module.exports=function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=7)}([function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("ethers")},function(e,t){e.exports=require("tronweb")},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t,r){"use strict";r.r(t);var n=r(0),i=r.n(n),a=r(1),s=r.n(a),u=r(5),c=r.n(u),o=r(6),h=r.n(o),d=r(4),l=r.n(d),p=r(3),v=r.n(p),f=r(2),g=(f.utils.keccak256,f.utils.sha256);f.utils.toUtf8Bytes,f.utils.recoverAddress,f.utils.SigningKey,f.utils.AbiCoder;function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(r,!0).forEach(function(t){l()(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(r).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}r.d(t,"default",function(){return b});var b=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];c()(this,e),t=m({},t,{privateKey:s}),r=m({},r,{privateKey:s}),this.mainchain=new v.a(t),this.sidechain=new v.a(r),this.isAddress=this.mainchain.isAddress,this.utils=this.mainchain.utils,this.setMainGatewayAddress(n),this.setSideGatewayAddress(i),this.setChainId(a),this.injectPromise=this.utils.promiseInjector(this),this.validator=this.mainchain.trx.validator;var u=this;this.sidechain.trx.sign=function(){return u.sign.apply(u,arguments)},this.sidechain.trx.multiSign=function(){return u.multiSign.apply(u,arguments)}}var t,r,n,a,u,o,d,l,p,f,y,b,x,w,k,P,T,K,j,A,O;return h()(e,[{key:"setMainGatewayAddress",value:function(e){if(!this.isAddress(e))throw new Error("Invalid main gateway address provided");this.mainGatewayAddress=e}},{key:"setSideGatewayAddress",value:function(e){if(!this.isAddress(e))throw new Error("Invalid side gateway address provided");this.sideGatewayAddress=e}},{key:"setChainId",value:function(e){if(!this.utils.isString(e)||!e)throw new Error("Invalid side chainId provided");this.chainId=e}},{key:"signTransaction",value:function(e,t){"string"==typeof e&&(e=this.utils.code.hexStr2byteArray(e));var r=this.utils.code.hexStr2byteArray(this.chainId),n=this.utils.code.hexStr2byteArray(t.txID).concat(r),i=g(n),a=this.utils.crypto.ECKeySign(this.utils.code.hexStr2byteArray(i.replace(/^0x/,"")),e);return Array.isArray(t.signature)?t.signature.includes(a)||t.signature.push(a):t.signature=[a],t}},{key:"multiSign",value:(O=s()(i.a.mark(function e(){var t,r,n,a,s,u,c,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=o.length>0&&void 0!==o[0]&&o[0],r=o.length>1&&void 0!==o[1]?o[1]:this.sidechain.defaultPrivateKey,n=o.length>2&&void 0!==o[2]&&o[2],a=o.length>3&&void 0!==o[3]&&o[3],this.utils.isFunction(n)&&(a=n,n=0),this.utils.isFunction(r)&&(a=r,r=this.mainchain.defaultPrivateKey,n=0),a){e.next=8;break}return e.abrupt("return",this.injectPromise(this.multiSign,t,r,n));case 8:if(this.utils.isObject(t)&&t.raw_data&&t.raw_data.contract){e.next=10;break}return e.abrupt("return",a("Invalid transaction provided"));case 10:return t.raw_data.contract[0].Permission_id=n,s=this.sidechain.address.toHex(this.sidechain.address.fromPrivateKey(r)).toLowerCase(),e.next=14,this.sidechain.trx.getSignWeight(t,n);case 14:if("PERMISSION_ERROR"!==(u=e.sent).result.code){e.next=17;break}return e.abrupt("return",a(u.result.message));case 17:if(c=!1,u.permission.keys.map(function(e){e.address===s&&(c=!0)}),c){e.next=21;break}return e.abrupt("return",a(r+" has no permission to sign"));case 21:if(!u.approved_list||-1==u.approved_list.indexOf(s)){e.next=23;break}return e.abrupt("return",a(r+" already sign transaction"));case 23:if(!u.transaction||!u.transaction.transaction){e.next=28;break}(t=u.transaction.transaction).raw_data.contract[0].Permission_id=n,e.next=29;break;case 28:return e.abrupt("return",a("Invalid transaction provided"));case 29:return e.prev=29,e.abrupt("return",a(null,this.signTransaction(r,t)));case 33:e.prev=33,e.t0=e.catch(29),a(e.t0);case 36:case"end":return e.stop()}},e,this,[[29,33]])})),function(){return O.apply(this,arguments)})},{key:"sign",value:(A=s()(i.a.mark(function e(){var t,r,n,a,s,u,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=c.length>0&&void 0!==c[0]&&c[0],r=c.length>1&&void 0!==c[1]?c[1]:this.sidechain.defaultPrivateKey,n=!(c.length>2&&void 0!==c[2])||c[2],a=c.length>3&&void 0!==c[3]&&c[3],s=c.length>4&&void 0!==c[4]&&c[4],this.utils.isFunction(a)&&(s=a,a=!1),this.utils.isFunction(n)&&(s=n,n=!0,a=!1),this.utils.isFunction(r)&&(s=r,r=this.sidechain.defaultPrivateKey,n=!0,a=!1),s){e.next=10;break}return e.abrupt("return",this.injectPromise(this.sign,t,r,n,a));case 10:if(!this.utils.isString(t)){e.next=21;break}if(this.utils.isHex(t)){e.next=13;break}return e.abrupt("return",s("Expected hex message input"));case 13:return e.prev=13,u=this.sidechain.trx.signString(t,r,n),e.abrupt("return",s(null,u));case 18:e.prev=18,e.t0=e.catch(13),s(e.t0);case 21:if(this.utils.isObject(t)){e.next=23;break}return e.abrupt("return",s("Invalid transaction provided"));case 23:if(a||!t.signature){e.next=25;break}return e.abrupt("return",s("Transaction is already signed"));case 25:if(e.prev=25,a){e.next=30;break}if(this.sidechain.address.toHex(this.sidechain.address.fromPrivateKey(r)).toLowerCase()===t.raw_data.contract[0].parameter.value.owner_address.toLowerCase()){e.next=30;break}return e.abrupt("return",s("Private key does not match address in transaction"));case 30:return e.abrupt("return",s(null,this.signTransaction(r,t)));case 33:e.prev=33,e.t1=e.catch(25),s(e.t1);case 36:case"end":return e.stop()}},e,this,[[13,18],[25,33]])})),function(){return A.apply(this,arguments)})},{key:"depositTrx",value:(j=s()(i.a.mark(function e(t,r){var n,a,s,u,c,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.length>2&&void 0!==o[2]?o[2]:{},a=o.length>3&&void 0!==o[3]?o[3]:this.mainchain.defaultPrivateKey,s=o.length>4&&void 0!==o[4]&&o[4],this.utils.isFunction(a)&&(s=a,a=this.mainchain.defaultPrivateKey),this.utils.isFunction(n)&&(s=n,n={}),s){e.next=7;break}return e.abrupt("return",this.injectPromise(this.depositTrx,t,r,n,a));case 7:if(!this.validator.notValid([{name:"callValue",type:"integer",value:t,gte:0},{name:"feeLimit",type:"integer",value:r,gt:0,lte:1e9}],s)){e.next=9;break}return e.abrupt("return");case 9:return n=m({callValue:t,feeLimit:r},n),e.prev=10,e.next=13,this.mainchain.contract().at(this.mainGatewayAddress);case 13:return u=e.sent,e.next=16,u.depositTRX().send(n,a);case 16:return c=e.sent,e.abrupt("return",s(null,c));case 20:return e.prev=20,e.t0=e.catch(10),e.abrupt("return",s(e.t0));case 23:case"end":return e.stop()}},e,this,[[10,20]])})),function(e,t){return j.apply(this,arguments)})},{key:"depositTrc10",value:(K=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o,h=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>3&&void 0!==h[3]?h[3]:{},s=h.length>4&&void 0!==h[4]?h[4]:this.mainchain.defaultPrivateKey,u=h.length>5&&void 0!==h[5]&&h[5],this.utils.isFunction(s)&&(u=s,s=this.mainchain.defaultPrivateKey),this.utils.isFunction(a)&&(u=a,a={}),u){e.next=7;break}return e.abrupt("return",this.injectPromise(this.depositTrc10,t,r,n,a,s));case 7:if(!this.validator.notValid([{name:"tokenValue",type:"integer",value:r,gte:0},{name:"feeLimit",type:"integer",value:n,gt:0,lte:1e9},{name:"tokenId",type:"integer",value:t,gte:0}],u)){e.next=9;break}return e.abrupt("return");case 9:return a=m({tokenId:t,tokenValue:r,feeLimit:n},a),e.prev=10,e.next=13,this.mainchain.contract().at(this.mainGatewayAddress);case 13:return c=e.sent,e.next=16,c.depositTRC10(t,r).send(a,s);case 16:o=e.sent,u(null,o),e.next=23;break;case 20:return e.prev=20,e.t0=e.catch(10),e.abrupt("return",u(e.t0));case 23:case"end":return e.stop()}},e,this,[[10,20]])})),function(e,t,r){return K.apply(this,arguments)})},{key:"depositTrc",value:(T=s()(i.a.mark(function e(t,r,n,a){var s,u,c,o,h,d,l=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=l.length>4&&void 0!==l[4]?l[4]:{},u=l.length>5&&void 0!==l[5]?l[5]:this.mainchain.defaultPrivateKey,c=l.length>6&&void 0!==l[6]&&l[6],this.utils.isFunction(u)&&(c=u,u=this.mainchain.defaultPrivateKey),this.utils.isFunction(s)&&(c=s,s={}),c){e.next=7;break}return e.abrupt("return",this.injectPromise(this.depositTrc,t,r,n,a,s,u));case 7:if(!this.validator.notValid([{name:"functionSelector",type:"not-empty-string",value:t},{name:"num",type:"integer",value:r,gte:0},{name:"feeLimit",type:"integer",value:n,gt:0,lte:1e9},{name:"contractAddress",type:"address",value:a}],c)){e.next=9;break}return e.abrupt("return");case 9:if(s=m({feeLimit:n},s,{callValue:0,tokenId:"",tokenValue:0}),e.prev=10,o=null,"approve"!==t){e.next=21;break}return e.next=15,this.mainchain.contract().at(a);case 15:return h=e.sent,e.next=18,h.approve(this.mainGatewayAddress,r).send(s,u);case 18:o=e.sent,e.next=44;break;case 21:return e.next=23,this.mainchain.contract().at(this.mainGatewayAddress);case 23:d=e.sent,e.t0=t,e.next="depositTRC20"===e.t0?27:"depositTRC721"===e.t0?31:"retryDeposit"===e.t0?35:"retryMapping"===e.t0?39:43;break;case 27:return e.next=29,d.depositTRC20(a,r).send(s,u);case 29:return o=e.sent,e.abrupt("break",44);case 31:return e.next=33,d.depositTRC721(a,r).send(s,u);case 33:return o=e.sent,e.abrupt("break",44);case 35:return e.next=37,d.retryDeposit(r).send(s,u);case 37:return o=e.sent,e.abrupt("break",44);case 39:return e.next=41,d.retryMapping(r).send(s,u);case 41:return o=e.sent,e.abrupt("break",44);case 43:return e.abrupt("break",44);case 44:c(null,o),e.next=50;break;case 47:return e.prev=47,e.t1=e.catch(10),e.abrupt("return",c(e.t1));case 50:case"end":return e.stop()}},e,this,[[10,47]])})),function(e,t,r,n){return T.apply(this,arguments)})},{key:"approveTrc20",value:(P=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},s=o.length>4&&void 0!==o[4]?o[4]:this.mainchain.defaultPrivateKey,u=o.length>5&&void 0!==o[5]&&o[5],c="approve",e.abrupt("return",this.depositTrc(c,t,r,n,a,s,u));case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return P.apply(this,arguments)})},{key:"approveTrc721",value:(k=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},s=o.length>4&&void 0!==o[4]?o[4]:this.mainchain.defaultPrivateKey,u=o.length>5&&void 0!==o[5]&&o[5],c="approve",e.abrupt("return",this.depositTrc(c,t,r,n,a,s,u));case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return k.apply(this,arguments)})},{key:"depositTrc20",value:(w=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},s=o.length>4&&void 0!==o[4]?o[4]:this.mainchain.defaultPrivateKey,u=o.length>5&&void 0!==o[5]&&o[5],c="depositTRC20",e.abrupt("return",this.depositTrc(c,t,r,n,a,s,u));case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return w.apply(this,arguments)})},{key:"depositTrc721",value:(x=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},s=o.length>4&&void 0!==o[4]?o[4]:this.mainchain.defaultPrivateKey,u=o.length>5&&void 0!==o[5]&&o[5],c="depositTRC721",e.abrupt("return",this.depositTrc(c,t,r,n,a,s,u));case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return x.apply(this,arguments)})},{key:"mappingTrc",value:(b=s()(i.a.mark(function e(t,r,n,a){var s,u,c,o,h,d=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=d.length>4&&void 0!==d[4]?d[4]:{},u=d.length>5&&void 0!==d[5]?d[5]:this.mainchain.defaultPrivateKey,c=d.length>6?d[6]:void 0,this.utils.isFunction(u)&&(c=u,u=this.mainchain.defaultPrivateKey),this.utils.isFunction(s)&&(c=s,s={}),c){e.next=7;break}return e.abrupt("return",this.injectPromise(this.mappingTrc,t,r,n,a,s,u));case 7:if(!this.validator.notValid([{name:"trxHash",type:"not-empty-string",value:t},{name:"mappingFee",type:"integer",value:r,gt:0},{name:"feeLimit",type:"integer",value:n,gt:0,lte:1e9}],c)){e.next=9;break}return e.abrupt("return");case 9:return t=t.startsWith("0x")?t:"0x"+t,s=m({feeLimit:n},s,{callValue:r}),e.prev=11,e.next=14,this.mainchain.contract().at(this.mainGatewayAddress);case 14:if(o=e.sent,h=null,"mappingTRC20"!==a){e.next=22;break}return e.next=19,o.mappingTRC20(t).send(s,u);case 19:h=e.sent,e.next=29;break;case 22:if("mappingTRC721"!==a){e.next=28;break}return e.next=25,o.mappingTRC721(t).send(s,u);case 25:h=e.sent,e.next=29;break;case 28:c(new Error("type must be trc20 or trc721"));case 29:c(null,h),e.next=35;break;case 32:return e.prev=32,e.t0=e.catch(11),e.abrupt("return",c(e.t0));case 35:case"end":return e.stop()}},e,this,[[11,32]])})),function(e,t,r,n){return b.apply(this,arguments)})},{key:"mappingTrc20",value:(y=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},s=o.length>4&&void 0!==o[4]?o[4]:this.mainchain.defaultPrivateKey,u=o.length>5&&void 0!==o[5]&&o[5],c="mappingTRC20",e.abrupt("return",this.mappingTrc(t,r,n,c,a,s,u));case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return y.apply(this,arguments)})},{key:"mappingTrc721",value:(f=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.length>3&&void 0!==o[3]?o[3]:{},s=o.length>4&&void 0!==o[4]?o[4]:this.mainchain.defaultPrivateKey,u=o.length>5&&void 0!==o[5]&&o[5],c="mappingTRC721",e.abrupt("return",this.mappingTrc(t,r,n,c,a,s,u));case 5:case"end":return e.stop()}},e,this)})),function(e,t,r){return f.apply(this,arguments)})},{key:"withdrawTrx",value:(p=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o,h=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=h.length>3&&void 0!==h[3]?h[3]:{},s=h.length>4&&void 0!==h[4]?h[4]:this.mainchain.defaultPrivateKey,u=h.length>5&&void 0!==h[5]&&h[5],this.utils.isFunction(s)&&(u=s,s=this.mainchain.defaultPrivateKey),this.utils.isFunction(a)&&(u=a,a={}),u){e.next=7;break}return e.abrupt("return",this.injectPromise(this.withdrawTrx,t,r,n,a,s));case 7:if(!this.validator.notValid([{name:"callValue",type:"integer",value:t,gte:0},{name:"withdrawFee",type:"integer",value:r,gte:0},{name:"feeLimit",type:"integer",value:n,gt:0,lte:1e9}],u)){e.next=9;break}return e.abrupt("return");case 9:return a=m({callValue:Number(t)+Number(r),feeLimit:n},a),e.prev=10,e.next=13,this.sidechain.contract().at(this.sideGatewayAddress);case 13:return c=e.sent,e.next=16,c.withdrawTRX().send(a,s);case 16:return o=e.sent,e.abrupt("return",u(null,o));case 20:return e.prev=20,e.t0=e.catch(10),e.abrupt("return",u(e.t0));case 23:case"end":return e.stop()}},e,this,[[10,20]])})),function(e,t,r){return p.apply(this,arguments)})},{key:"withdrawTrc10",value:(l=s()(i.a.mark(function e(t,r,n,a){var s,u,c,o,h,d=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=d.length>4&&void 0!==d[4]?d[4]:{},u=d.length>5&&void 0!==d[5]?d[5]:this.mainchain.defaultPrivateKey,c=d.length>6&&void 0!==d[6]&&d[6],this.utils.isFunction(u)&&(c=u,u=this.mainchain.defaultPrivateKey),this.utils.isFunction(s)&&(c=s,s={}),c){e.next=7;break}return e.abrupt("return",this.injectPromise(this.withdrawTrc10,t,r,n,a,s,u));case 7:if(!this.validator.notValid([{name:"tokenId",type:"integer",value:t,gte:0},{name:"tokenValue",type:"integer",value:r,gte:0},{name:"withdrawFee",type:"integer",value:n,gte:0},{name:"feeLimit",type:"integer",value:a,gt:0,lte:1e9}],c)){e.next=9;break}return e.abrupt("return");case 9:return s=m({tokenValue:r,tokenId:t,callValue:n,feeLimit:a},s),e.prev=10,e.next=13,this.sidechain.contract().at(this.sideGatewayAddress);case 13:return o=e.sent,e.next=16,o.withdrawTRC10(t,r).send(s,u);case 16:return h=e.sent,e.abrupt("return",c(null,h));case 20:return e.prev=20,e.t0=e.catch(10),e.abrupt("return",c(e.t0));case 23:case"end":return e.stop()}},e,this,[[10,20]])})),function(e,t,r,n){return l.apply(this,arguments)})},{key:"withdrawTrc",value:(d=s()(i.a.mark(function e(t,r,n,a,u){var c,o,h,d,l,p,v,f,g,y,b=this,x=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(c=x.length>5&&void 0!==x[5]?x[5]:{},o=x.length>6&&void 0!==x[6]?x[6]:this.mainchain.defaultPrivateKey,h=x.length>7&&void 0!==x[7]&&x[7],this.utils.isFunction(o)&&(h=o,o=this.mainchain.defaultPrivateKey),this.utils.isFunction(c)&&(h=c,c={}),h){e.next=7;break}return e.abrupt("return",this.injectPromise(this.withdrawTrc,t,r,n,a,u,c,o));case 7:if(!this.validator.notValid([{name:"functionSelector",type:"not-empty-string",value:t},{name:"numOrId",type:"integer",value:r,gte:0},{name:"withdrawFee",type:"integer",value:n,gte:0},{name:"feeLimit",type:"integer",value:a,gt:0,lte:1e9},{name:"contractAddress",type:"address",value:u}],h)){e.next=9;break}return e.abrupt("return");case 9:return c=m({feeLimit:a},c,{callValue:n}),d=[{type:"uint256",value:r}],e.prev=11,l=o?this.sidechain.address.fromPrivateKey(o):this.sidechain.defaultAddress.base58,e.next=15,this.sidechain.transactionBuilder.triggerSmartContract(u,t,c,d,this.sidechain.address.toHex(l));case 15:if((p=e.sent).result&&p.result.result){e.next=18;break}return e.abrupt("return",h("Unknown error: "+JSON.stringify(p.transaction,null,2)));case 18:return e.next=20,this.sidechain.trx.sign(p.transaction,o);case 20:if((v=e.sent).signature){e.next=25;break}if(o){e.next=24;break}return e.abrupt("return",h("Transaction was not signed properly"));case 24:return e.abrupt("return",h("Invalid private key provided"));case 25:return e.next=27,this.sidechain.trx.sendRawTransaction(v);case 27:if(!(f=e.sent).code){e.next=32;break}return g={error:f.code,message:f.code},f.message&&(g.message=this.sidechain.toUtf8(f.message)),e.abrupt("return",h(g));case 32:if(c.shouldPollResponse){e.next=34;break}return e.abrupt("return",h(null,v.txID));case 34:(y=function(){var e=s()(i.a.mark(function e(){var t,r,n,a=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(20!=(t=a.length>0&&void 0!==a[0]?a[0]:0)){e.next=3;break}return e.abrupt("return",h({error:"Cannot find result in solidity node",transaction:v}));case 3:return e.next=5,b.sidechain.trx.getTransactionInfo(v.txID);case 5:if(r=e.sent,Object.keys(r).length){e.next=8;break}return e.abrupt("return",setTimeout(function(){y(t+1)},3e3));case 8:if(!r.result||"FAILED"!=r.result){e.next=10;break}return e.abrupt("return",h({error:b.sidechain.toUtf8(r.resMessage),transaction:v,output:r}));case 10:if(utils.hasProperty(r,"contractResult")){e.next=12;break}return e.abrupt("return",h({error:"Failed to execute: "+JSON.stringify(r,null,2),transaction:v,output:r}));case 12:if(!c.rawResponse){e.next=14;break}return e.abrupt("return",h(null,r));case 14:return 1===(n=decodeOutput(b.outputs,"0x"+r.contractResult[0])).length&&(n=n[0]),e.abrupt("return",h(null,n));case 17:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}())(),e.next=41;break;case 38:return e.prev=38,e.t0=e.catch(11),e.abrupt("return",h(e.t0));case 41:case"end":return e.stop()}},e,this,[[11,38]])})),function(e,t,r,n,i){return d.apply(this,arguments)})},{key:"withdrawTrc20",value:(o=s()(i.a.mark(function e(t,r,n,a,s){var u,c,o,h=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=h.length>5&&void 0!==h[5]?h[5]:this.mainchain.defaultPrivateKey,c=h.length>6&&void 0!==h[6]&&h[6],o="withdrawal(uint256)",e.abrupt("return",this.withdrawTrc(o,t,r,n,a,s,u,c));case 4:case"end":return e.stop()}},e,this)})),function(e,t,r,n,i){return o.apply(this,arguments)})},{key:"withdrawTrc721",value:(u=s()(i.a.mark(function e(t,r,n,a,s){var u,c,o,h=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=h.length>5&&void 0!==h[5]?h[5]:this.mainchain.defaultPrivateKey,c=h.length>6&&void 0!==h[6]&&h[6],o="withdrawal(uint256)",e.abrupt("return",this.withdrawTrc(o,t,r,n,a,s,u,c));case 4:case"end":return e.stop()}},e,this)})),function(e,t,r,n,i){return u.apply(this,arguments)})},{key:"injectFund",value:(a=s()(i.a.mark(function e(t,r,n){var a,s,u,c,o,h,d,l,p=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=p.length>3&&void 0!==p[3]?p[3]:this.mainchain.defaultPrivateKey,s=p.length>4&&void 0!==p[4]&&p[4],this.utils.isFunction(a)&&(s=a,a=this.mainchain.defaultPrivateKey),this.utils.isFunction(n)&&(s=n,n={}),s){e.next=6;break}return e.abrupt("return",this.injectPromise(this.injectFund,t,r,n,a));case 6:if(!this.validator.notValid([{name:"num",type:"integer",value:t,gte:0},{name:"feeLimit",type:"integer",value:r,gt:0,lte:1e9}],s)){e.next=8;break}return e.abrupt("return");case 8:return e.prev=8,u=this.sidechain.address.fromPrivateKey(a),c=this.sidechain.address.toHex(u),e.next=13,this.sidechain.fullNode.request("/wallet/fundinject",{owner_address:c,amount:t},"post");case 13:return o=e.sent,e.next=16,this.sidechain.trx.sign(o,a);case 16:if((h=e.sent).signature){e.next=21;break}if(a){e.next=20;break}return e.abrupt("return",s("Transaction was not signed properly"));case 20:return e.abrupt("return",s("Invalid private key provided"));case 21:return e.next=23,this.sidechain.trx.sendRawTransaction(h);case 23:if(!(d=e.sent).code){e.next=28;break}return l={error:d.code,message:d.code},d.message&&(l.message=this.mainchain.toUtf8(d.message)),e.abrupt("return",s(l));case 28:return e.abrupt("return",s(null,h.txID));case 31:return e.prev=31,e.t0=e.catch(8),e.abrupt("return",s(e.t0));case 34:case"end":return e.stop()}},e,this,[[8,31]])})),function(e,t,r){return a.apply(this,arguments)})},{key:"retryWithdraw",value:(n=s()(i.a.mark(function e(t,r){var n,a,s,u,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3&&void 0!==c[3]?c[3]:this.sidechain.defaultPrivateKey,s=c.length>4&&void 0!==c[4]&&c[4],u="retryWithdraw(uint256)",e.abrupt("return",this.withdrawTrc(u,t,0,r,this.sideGatewayAddress,n,a,s));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})},{key:"retryDeposit",value:(r=s()(i.a.mark(function e(t,r){var n,a,s,u,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3&&void 0!==c[3]?c[3]:this.mainchain.defaultPrivateKey,s=c.length>4&&void 0!==c[4]&&c[4],u="retryDeposit",e.abrupt("return",this.depositTrc(u,t,r,this.mainGatewayAddress,n,a,s));case 5:case"end":return e.stop()}},e,this)})),function(e,t){return r.apply(this,arguments)})},{key:"retryMapping",value:(t=s()(i.a.mark(function e(t,r){var n,a,s,u,c=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>2&&void 0!==c[2]?c[2]:{},a=c.length>3&&void 0!==c[3]?c[3]:this.mainchain.defaultPrivateKey,s=c.length>4&&void 0!==c[4]&&c[4],u="retryMapping",e.abrupt("return",this.depositTrc(u,t,r,this.mainGatewayAddress,n,a,s));case 5:case"end":return e.stop()}},e,this)})),function(e,r){return t.apply(this,arguments)})}]),e}();l()(b,"TronWeb",v.a)}]).default;
//# sourceMappingURL=SunWeb.node.js.map